<div class="alert alert-danger">
	<strong>Hinweis!</strong> Das Drag and Drop ist noch in der Entwicklung, bitte verwenden Sie die Button/Checkboxes/DropDown.
</div>
<div class="row">
	<div class="col-sm-8">
<div class="card card-block">
	<!--Input with the name of the table-->
	<h2 class="card-title">
		<input class="form-control tableEditorTableName" (focus)="saveTempValue($event.target.value)" (blur)="changedTableName($event.target.value)" [(ngModel)]="table.name" placeholder="Tabellen Name" />
	</h2>
	<p class="card-text"></p>

	<!--Header for the table-->
	<div class="card-deck-wrapper">
		<div class="card-deck">
			<div class="card-group">
				<div class="card  tableColumn">
					<h4 class="card-title"># Name</h4>
				</div>
				<div class="card  tableColumn">
					<h4 class="card-title">PK</h4>
				</div>
				<div class="card  tableColumn">
					<h4 class="card-title">Type</h4>
				</div>
				<div class="card  tableColumn">
					<h4 class="card-title">Not Null</h4>
				</div>
				<div class="card  tableColumn">
					<h4 class="card-title">Standardwert</h4>
				</div>
			</div>

			<!--Every column as a card-->
			<div *ngFor="let column of table.columns" class="card-group columns">
				<div class="card  tableColumn">
					<!--Column index, name and button to delete the column-->
					<div class="tableNameBtn">
						<div class="tableNameBtnCell">
						<label>{{ column.index }}</label>
						<span class="tag tag-danger " (click)="removeColumn(column.index)">
							<span class="fa fa-minus" aria-hidden="true"></span>
						</span>
						</div>
						<input  class="form-control tableEditorName tableNameBtnCell" id="example-text-input" (focus)="saveTempValue($event.target.value)" [disabled]="column.stateName == 'deleted'" (blur)="changedColumnName(column.index, $event.target.value)" [(ngModel)]="column.name" placeholder="Name" />
					</div>
				</div>
				<!--Primray key checkbox-->
				<div class="card  tableColumn">

					<label class="custom-control custom-checkbox">
						<input type="checkbox" class="custom-control-input" (click)="ChangeColumnPrimaryKeyStatus(column.index)" [(ngModel)]="column.primary" [disabled]="column.stateName == 'deleted'" placeholder="Primary" />
							<span class="custom-control-indicator"></span>
							<span class="custom-control-description">
								<span *ngIf=column.primary>
									<span class="tag tag-pill tag-primary">
										<span class="fa fa-key" aria-hidden="true"></span>
								</span>
							</span>
						</span>
					</label>

				</div>
				<!--Column type input-->
				<div class="card  tableColumn">

					<select class="custom-select" [(ngModel)]="column.type" (focus)="saveTempValue($event.target.value)" [disabled]="column.stateName == 'deleted'" (change)="changedColumnType(column.index, $event.target.value)">
					<option disabled selected>Datentyp</option>
					<option value="TEXT">TEXT</option>
					<option value="INTEGER">INTEGER</option>
					<option value="FLOAT">FLOAT</option>
					<option value="BOOLEAN">BOOLEAN</option>
					<option value="URL">URL</option>
  				</select>
					<span *ngIf="table.columnIsForeignKeyOfTable(column.name)">
						<span class="tag tag-pill tag-success">
							{{ table.columnIsForeignKeyOfTable(column.name) }} 
							<span class="tag tag-pill tag-info">
								{{ table.columnIsForeignKeyOfColumn(column.name) }} 
							</span>
							<span class="tag tag-danger" (click)="removeForeignKey(column.index,  table.columnIsForeignKeyOfTable(column.name) ,  table.columnIsForeignKeyOfColumn(column.name) )">
								<span class="fa fa-minus" aria-hidden="true"></span>
							</span>
						</span>
					</span>
				</div>
				<!--Column not null checkbox-->
				<div class="card  tableColumn">

					<label class="custom-control custom-checkbox"  >
						<input type="checkbox" class="custom-control-input" [(disabled)]="column.primary" (click)="ChangeColumnNotNullStatus(column.index)" [(ngModel)]="column.not_null" [disabled]="column.stateName == 'deleted'" placeholder="Not Null" />
							<span class="custom-control-indicator" [(hidden)]="column.primary"></span>
								<span class="custom-control-description" >
									<span *ngIf="column.not_null || column.primary">
										<span class="tag tag-pill tag-default">
											Not Null
										</span>
								</span>
							</span>
					</label>

				</div>
				<!--Column default value input-->
				<div class="card  tableColumn">
					<input class="tableEditorDfltVal  form-control" (focus)="saveTempValue($event.target.value)" [disabled]="column.stateName == 'deleted'" (blur)="changedColumnStandartValue(column.index, $event.target.value)" [(ngModel)]="column.dflt_value" placeholder="Standardwert" />
				</div>
			</div>
			<!--Add column button-->
			<div class="card-group">
				<div class="card  tableColumn">
					<h6 class="card-title">
						<span class="tag tag-primary" (click)="addColumn()">
							<span class="fa fa-plus" aria-hidden="true"></span>
						</span>
						<br>

						Switch:&nbsp; 
						<select class="custom-select editordrop" [(ngModel)]="colToSwitch">
							<option disabled selected value="undefined">Spalte</option>
							<option *ngFor="let column of table.columns" [value]="column.index">{{column.name}}</option>
						</select>

						<select  class="custom-select"[(ngModel)]="switch_to">
							<option disabled selected value="undefined">an Position</option>
							<option *ngFor="let column of table.columns" [value]="column.index">Position : {{column.index}}</option>
						</select>
						<a (click)="changeColumnOrder()" class="btn btn-primary">
							<span class="fa fa-exchange" aria-hidden="true"></span>
						</a>


						<br>
						
						Add FK: 
						<select class="custom-select editordrop" [(ngModel)]="fk_fromColumn">
							<option disabled selected value="undefined">Spalte</option>
							<ng-container *ngFor="let column of table.columns">
								<option *ngIf="(table.columnIsForeignKeyOfTable(column.name) == undefined)" [value]="column.index">{{column.name}}</option>
							</ng-container>
						</select>

						<select class="custom-select editordrop" *ngIf=fk_fromColumn [(ngModel)]="fk_addTable">
							<option disabled selected value="undefined">zur Tabelle</option>
							<option *ngFor="let tab of projectTables" [value]="tab.name">{{tab.name}}</option>
						</select>

						<select class="custom-select editordrop" *ngIf=fk_addTable [(ngModel)]="fk_addColumn">
							<option disabled selected value="undefined">zur Spalte</option>
							<option *ngFor="let column of getColumnsOfTable().columns" [value]="column.name">{{column.name}}</option>
						</select>

						<a *ngIf=fk_addColumn (click)="addForeignKey()" class="btn btn-primary">
							<span class="fa fa-arrows-h" aria-hidden="true"></span>
						</a>



					</h6>
				</div>
			</div>
		</div>
	</div>
</div>



<!--Table-Deatils as preview for changes to the table-->
<sql-table-details *ngIf="_showPreview && !isNewTable" [isChild]="true"></sql-table-details>

</div>
<div class="col-sm-4">
	<div class="card">
		<div>
			<h4>
				<span class="tag tag-default"><span class="fa fa-columns" aria-hidden="true"></span> Neue Spalte <span class="tag tag-pill tag-warning">TEXT</span></span>
				<span class="tag tag-default"><span class="fa fa-columns" aria-hidden="true"></span> Neue Spalte <span class="tag tag-pill tag-warning">INTEGER</span></span>
				<span class="tag tag-default"><span class="fa fa-columns" aria-hidden="true"></span> Neue Spalte <span class="tag tag-pill tag-warning">FLOAT</span></span>
				<span class="tag tag-default"><span class="fa fa-columns" aria-hidden="true"></span> Neue Spalte <span class="tag tag-pill tag-warning">BOOLEAN</span></span>
				<span class="tag tag-default"><span class="fa fa-columns" aria-hidden="true"></span> Neue Spalte <span class="tag tag-pill tag-warning">URL</span></span>
			</h4>
		</div>
		<div>
			<h3>
				<span class="tag tag-pill tag-primary"><div class="fa fa-key" aria-hidden="true"></div></span>
				<span class="tag tag-pill tag-default">Not Null</span>
			</h3>
		</div>

		<div *ngFor="let tab of projectTables">
			<h4>
				<span class="tag tag-success"><span class="fa fa-table" aria-hidden="true"></span>{{tab.name}}</span>
				<div>
					<h5>
						<span *ngFor="let column of tab.columns" class="tag tag-pill tag-info">{{column.name}}</span>
					</h5>
				</div>
			</h4>
		</div>

	</div>

	<div class="list-group">
		<!--List of stack entrys-->
		<button type="button" class="list-group-item list-group-item-action active">
			Stackgröße: <span class="badge badge-default badge-pill">{{ commandsHolder.commands.length }}</span> 
		</button>
		<button type="button" class="list-group-item list-group-item-action" (click)="loadStackPosition(-1)">
					<span *ngIf="-1 == commandsHolder.activeIndex" class="fa fa-play" aria-hidden="true"></span>
					Ursprungstabelle
		</button>
		<!--List body, with every stack entry-->
		<button type="button" class="list-group-item list-group-item-action" *ngFor="let cmd of commandsHolder.commands" (click)="loadStackPosition(cmd.index)" 
				[ngClass]="{'list-group-item-danger': cmd.index == dbErrorCode}">
					<span *ngIf="cmd.index == commandsHolder.activeIndex" class="fa fa-play" aria-hidden="true"></span>
					{{cmd.index}} : {{ cmd.commandText }}
		</button>
	</div>
</div>
</div>