image: marcusriemer/sqlino:test

pipelines:
  default:
    - step:
        caches:
          - node-client
          - node-schema
          - bundler-local
        script:
          - make install-deps
          - make dist-dev
          - make -C server test
          - TEST_SINGLE_RUN=true make -C client test
        services:
          - db

definitions:
  caches:
    bundler-local: server/vendor
    node-client: client/node_modules
    node-schema: schema/json/node_modules
  services:
    db:
      image: postgres:10.0
      environment:
        POSTGRES_DB: 'esqulino_test' 
        POSTGRES_USER: 'esqulino'
