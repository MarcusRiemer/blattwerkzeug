##################################
# Setting up shared paths
##################################

# Full path of typescript-json-schema
TYPESCRIPT_JSON_SCHEMA_BIN = $(SCHEMA_PATH)/node_modules/.bin/typescript-json-schema
SCHEMA_OPTIONS = --noExtraProps true --required true

# Names of the schema files to generate
JSON_SCHEMA_FILE_NAMES = PageDescription.json PageUpdateRequestDescription.json PageRenderRequestDescription.json ProjectDescription.json ProjectUpdateDescription.json ProjectCreationDescription.json ProjectListDescription.json QueryResultDescription.json QueryParamsDescription.json ArbitraryQueryRequestDescription.json QueryUpdateRequestDescription.json QueryDescription.json RequestErrorDescription.json AlterSchemaRequestDescription.json TableDescription.json LanguageModelDocument.json NodeDescription.json

# Paths of the schema files to generate
JSON_SCHEMA_FILES = $(addprefix $(SCHEMA_PATH)/, $(JSON_SCHEMA_FILE_NAMES))

##################################
# Not so nice: Repeated rules
##################################

define CONVERT_COMMAND
	@echo "Creating $(notdir $(basename $@)).json"
	$(TYPESCRIPT_JSON_SCHEMA_BIN) $(SRC_PROJECT) $(notdir $(basename $@)) --out $@ $(SCHEMA_OPTIONS)
endef

$(SCHEMA_PATH)/PageUpdateRequestDescription.json : $(SRC_PATH)/editor/page.service.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/PageDescription.json : $(SRC_PATH)/shared/page/page.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/ProjectDescription.json : $(SRC_PATH)/shared/project.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/ProjectUpdateDescription.json : $(SRC_PATH)/shared/project.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/ProjectCreationDescription.json : $(SRC_PATH)/shared/project.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/ProjectListDescription.json : $(SRC_PATH)/shared/project.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/QueryDescription.json : $(SRC_PATH)/shared/query/description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/QueryUpdateRequestDescription.json : $(SRC_PATH)/editor/query.service.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/QueryResultDescription.json : $(SRC_PATH)/shared/query/result.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/RequestErrorDescription.json : $(SRC_PATH)/shared/query/result.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/QueryParamsDescription.json : $(SRC_PATH)/editor/query.service.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/ArbitraryQueryRequestDescription.json : $(SRC_PATH)/editor/query.service.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/PageRenderRequestDescription.json : $(SRC_PATH)/editor/page.service.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/AlterSchemaRequestDescription.json : $(SRC_PATH)/shared/schema/table-commands.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/TableDescription.json : $(SRC_PATH)/shared/schema/schema.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/LanguageModelDocument.json : $(SRC_PATH)/shared/block/language-model.description.ts
	$(CONVERT_COMMAND)

$(SCHEMA_PATH)/NodeDescription.json : $(SRC_PATH)/shared/syntaxtree/syntaxtree.description.ts
	$(CONVERT_COMMAND)





